x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
# Line plot with a separate line per gene, colored by species
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
species_palette <- c(
"Montipora_capitata" = "hotpink1",
"Pocillopora_acuta" = "darkmagenta",
"Acropora_tenuis" = "cyan4",
"Stylophora_pistillata" = "steelblue3"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Protein",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "Dot-dash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "Dot-dash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "dot-dash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "dot-dash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "dotdash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
# Bring in dataset
SOM_R <- read_csv("GitHub/Multistage_omics/SOM_analysis/SOM_R_dataset.csv")
# Remove empty columns and rows
SOM_R <- SOM_R %>% select(where(~ !all(is.na(.))))
SOM_R <- SOM_R %>% filter(if_any(everything(), ~ !is.na(.)))
# Add Family column based on Species
SOM_R <- SOM_R %>%
mutate(Family = case_when(
Species %in% c("Acropora_tenuis", "Montipora_capitata") ~ "Acroporidae",
Species %in% c("Stylophora_pistillata", "Pocillopora_acuta") ~ "Pocilloporidae",
TRUE ~ "Other"  # Optional: for species not listed
))
# Calculate Z scores for every gene
SOM_R <- SOM_R %>%
group_by(Protein, Gene) %>%
mutate(Z_scores = (Expression - mean(Expression, na.rm = TRUE)) / sd(Expression, na.rm = TRUE))
# Calculate mean expression for every life stage of every species per protein
SOM_R_summary <- SOM_R %>%
group_by(Protein, Species, Family, Life_stage, Gene) %>%
summarize(mean_expression = mean(Expression, na.rm = TRUE),
mean_Z_score = mean(Z_scores, na.rm = TRUE),
.groups = "drop")
species_palette <- c(
"Montipora_capitata" = "hotpink1",
"Pocillopora_acuta" = "darkmagenta",
"Acropora_tenuis" = "cyan4",
"Stylophora_pistillata" = "chartreuse3"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
family_palette <- c(
"Acroporidae" = "hotpink1",
"Pocilloporidae" = "cyan4"
)
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "dotdash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score, color = Species, group = Species)) +
geom_line(size = 1) +  # Line for each species
geom_point(size = 3) +  # Points at each life stage
facet_wrap(~ Protein, scales = "free_y") +  # Separate plots for each protein
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Species",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(plot_data, aes(x = Life_stage, y = Mean_Z_score, color = Species, shape = Species, group = Species)) +
geom_point(size = 3) +
geom_line(linewidth = 1) +
geom_errorbar(aes(ymin = Mean_Z_score - SE_Z_score, ymax = Mean_Z_score + SE_Z_score), width = 0.2) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
plot.title = element_text(hjust = 0.5, face = "bold")
) +
labs(
title = "Normalized Gene Expression Across Life Stages in Coral Species",
x = "Life Stage",
y = "Mean Z-Score"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score, color = Species, group = Species)) +
geom_line(size = 1) +  # Line for each species
geom_point(size = 3) +  # Points at each life stage
facet_wrap(~ Protein, scales = "free_y") +  # Separate plots for each protein
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Species",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Family)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
gplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = species_palette)) +  # Line type for Family
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1) +
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1) +
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Species, group = interaction(Species, Gene))) +
geom_line(size = 1) +
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = species_palette)  # Apply custom colors
# Line plot with species as separate lines but colored by family
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score, color = Family, group = Species, linetype = Species)) +
geom_line(size = 1) +
geom_point(size = 3) +
facet_wrap(~ Protein, scales = "free_y") +
scale_color_manual(values = family_colors) +  # Assign colors by family
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by Species (Colored by Family)",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
species_linetypes <- c(
"Montipora_capitata" = "solid",
"Acropora_tenuis" = "dashed",
"Pocillopora_acuta" = "dotted",
"Stylophora_pistillata" = "dotdash"
)
ggplot(SOM_R_summary, aes(x = Life_stage, y = mean_Z_score,
color = Family, group = interaction(Species, Gene))) +
geom_line(size = 1, aes(linetype = Species)) +  # Different linetypes for species
geom_point(size = 2) +
facet_wrap(~ Protein, scales = "free_y") +
theme_minimal() +
labs(title = "Mean Z-scores Across Life Stages by SOM Protein-Coding Gene",
x = "Life Stage",
y = "Mean Z-score") +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_color_manual(values = family_palette) +  # Apply family colors
scale_linetype_manual(values = species_linetypes)  # Apply species linetypes
# Identify genes to keep by count filter
gkeep <- gcount[gfilt, ]
library("tidyverse")
library("genefilter")
library("DESeq2")
library("RColorBrewer")
library("WGCNA")
library("flashClust")
library("gridExtra")
library("ComplexHeatmap")
library("goseq")
library("clusterProfiler")
library("pheatmap")
library("magrittr")
library("vegan")
library("factoextra")
library("dplyr")
library("dendsort")
library("NbClust")
library("simplifyEnrichment")
library("factoextra")
library("VennDiagram")
library("patchwork")
library("dendsort")
library("ggplot2")
library("dplyr")
library("sva")
setwd("C:/Users/amurg/OneDrive/Documentos/GitHub/Multistage_omics/WGCNA/Multi_species_WGCNA")
# Load necessary library
library(readr)
# Read the CSV file with specified column types
gcount_raw <- read_csv("merged_data_acropora_montipora_pocillopora_spis.csv",
col_types = cols(
DRR318288 = col_integer(),
DRR318289 = col_integer(),
DRR318291 = col_integer(),
DRR318293 = col_integer(),
DRR318294 = col_integer(),
DRR318295 = col_integer(),
DRR318297 = col_integer(),
DRR318298 = col_integer(),
DRR318299 = col_integer(),
AH1 = col_integer(),
AH2 = col_integer(),
SRR14333320 = col_integer(),
SRR14333321 = col_integer(),
SRR14333322 = col_integer(),
SRR14333323 = col_integer(),
SRR14333324 = col_integer(),
SRR14333325 = col_integer(),
SRR14333326 = col_integer(),
SRR14333327 = col_integer()
))
treatmentinfo <- read_csv("treatmentinfo_merged.csv")
# Identify columns that need to be renamed (7 onward)
old_names <- colnames(gcount_raw)[7:ncol(gcount_raw)]
# Match old names with new_names in treatmentinfo
new_names <- treatmentinfo$new_names[match(old_names, treatmentinfo$sampleID)]
# Replace only the column names from column 7 onward
colnames(gcount_raw)[7:ncol(gcount_raw)] <- ifelse(is.na(new_names), old_names, new_names)
# Define column ranges
spis_spat_cols <- 34:36  # Current positions of Spis spat
spis_larvae_cols <- 40:42  # Current positions of Spis larvae
# Define column ranges
spis_spat_cols <- 34:36  # Current positions of Spis spat
spis_larvae_cols <- 40:42  # Current positions of Spis larvae
# Swap the columns
gcount_raw <- gcount_raw[, c(1:33, spis_larvae_cols, 37:39, spis_spat_cols)]
#Now I'm making a dataframe and calling Orthogroup rownames
gcount_raw <- as.data.frame(gcount_raw)
rownames(gcount_raw) <- gcount_raw$Orthogroup  # If gene IDs are in a column
# Extract only the count data (columns 7 to 42)
gcount <- gcount_raw[, 7:42]
# Set filter values for PoverA
filt <- filterfun(pOverA(0.083, 10))
# Apply filter to count data only
gfilt <- genefilter(gcount, filt)
# Identify genes to keep by count filter
gkeep <- gcount[gfilt, ]
gkeep
# Identify gene names to keep
gn.keep <- rownames(gkeep)
# Subset the original dataset to keep metadata and filtered count data
gcount_filt <- gcount[rownames(gcount) %in% gn.keep, ]
# Load required libraries
library(readr)
library(readxl)
library(dplyr)
library(stringr)
# ---- 1. Load your gcount_raw data ----
gcount_raw <- read_csv("gcount_raw.csv")
# ---- 2. Load the Spis annotation file ----
spis_annot <- read_excel("Spis_annot.csv")
# ---- 2. Load the Spis annotation file ----
spis_annot <- read_csv("Spis_annot.csv")
# ---- 3. Fix gene_id in gcount_raw: remove "Gene" from SpisGene1234 -> Spis1234
gcount_raw <- gcount_raw %>%
mutate(Gene_ID_fixed = str_replace(sampleID, "Gene_", "Spis"))
gcount_raw <- gcount_raw %>%
mutate(Gene_ID_fixed = str_replace(sampleID, "Gene_", "Spis"))
View(gcount_raw)
View(gcount_raw)
# ---- 4. Merge with annotations ----
merged_data <- gcount_raw %>%
left_join(spis_annot, by = c("GeneID_Spis" = "gene_id_fixed"))
# ---- 3. Fix gene_id in Spis_annot: remove "Gene" from SpisGene1234 -> Spis1234
spis_annot <- spis_annot %>%
mutate(gene_id_fixed = str_replace(gene_id, "Gene", ""))
# ---- 4. Merge with annotations ----
merged_data <- gcount_raw %>%
left_join(spis_annot, by = c("GeneID_Spis" = "gene_id_fixed"))
View(merged_data)
# ---- 5. Save the new merged file ----
write.csv(merged_data, "gcount_raw_with_annotations.csv", row.names = FALSE)
